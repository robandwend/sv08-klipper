[gcode_macro SAVE_TOOL_TEMPS]
variable_temp_tool0: 0.0
variable_temp_tool1: 0.0
variable_temp_tool2: 0.0
variable_temp_tool3: 0.0
gcode:
   {% set temp = printer['extruder'].temperature %}
   SET_GCODE_VARIABLE MACRO=SAVE_TOOL_TEMPS VARIABLE=temp_tool0 VALUE={temp}
   RESPOND TYPE='echo' MSG="Saved temperature T0 = {temp}"
   {% set temp = printer['extruder1'].temperature %}
   SET_GCODE_VARIABLE MACRO=SAVE_TOOL_TEMPS VARIABLE=temp_tool1 VALUE={temp}
   RESPOND TYPE='echo' MSG="Saved temperature T1 = {temp}"
   {% set temp = printer['extruder2'].temperature %}
   SET_GCODE_VARIABLE MACRO=SAVE_TOOL_TEMPS VARIABLE=temp_tool2 VALUE={temp}
   RESPOND TYPE='echo' MSG="Saved temperature T2 = {temp}"
   {% set temp = printer['extruder3'].temperature %}
   SET_GCODE_VARIABLE MACRO=SAVE_TOOL_TEMPS VARIABLE=temp_tool3 VALUE={temp}
   RESPOND TYPE='echo' MSG="Saved temperature T3 = {temp}"

[gcode_macro RESTORE_TOOL_TEMPS]
gcode:    
    {% for i in range(0, 3) %}
        {% set var = "gcode macro SAVE_TOOL_TEMPS{i}" %}
        {% set temp = printer[var].temp_tool[i] %}
        {% if temp > 0 %}
            M104 S{temp} T{i}
            RESPOND TYPE='echo' MSG="Restoring T{i} to {temp}Â°C"
        {% endif %}
    {% endfor %}

