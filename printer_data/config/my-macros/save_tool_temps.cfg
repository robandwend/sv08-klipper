[gcode_macro SAVE_TOOL_TEMPS]
variable_saved_temps: {}
gcode:
    {% set saved = {} %}
    {% for name in printer %}
        {% if name.startswith("extruder") %}
            {% set temp = printer[name].temperature %}
            {% set _ = saved.update({name: temp}) %}
            RESPOND TYPE='echo' MSG="Saved temperature { name } = {temp}"
        {% endif %}
    {% endfor %}
    SET_GCODE_VARIABLE MACRO=SAVE_TOOL_TEMPS VARIABLE=saved_temps VALUE={saved}


[gcode_macro RESTORE_TOOL_TEMPS]
gcode:
    {% for name, temp in SAVE_TOOL_TEMPS.saved_temps.items() %}
        M104 S={{ '%.1f' % temp }} TOOL={{ name | regex_replace('extruder', '') | default('0') }}
        RESPOND TYPE+'echo' MSG="Restoring {name} to {temp}Â°C"
    {% endfor %}
